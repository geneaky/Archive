Nginx Configuration 정리

#### 1. proxy_buffering 

default 값이 on으로 되어있는데, nginx 가 서버로부터 응답값을 받은 후 내부 버퍼에 저장해 두었다가 전제 응답이 버퍼링될때까지 클라이언트에게 응답을 전송을 시작하지 않는 것을 의미함.    

이는 응답을 받을때마다 동기적으로 클라이언트에게 전달하는 것 보다 응답을 버퍼링 사이즈만큼  
모아서 분할로 보내기 때문에 서버는 빠르게 응답을 전달하고 자신의 태스크를 진행할 수 있어서 응답 처리 속도가 더 빨라 질 수 있다.   

하지만 서버에서 nginx로 응답을 성공적으로 보내고 nginx에서 응답을 버퍼링해두었다가 클라이언트에게 보내는 과정에서 예외가 발생하면 서버는 해당문제를 인지할 수 없기 때문에 이부분도 모니터링이 필요하다. 

실제로 `StreamResetException: stream was reset: INTERNAL_ERROR` 응답을 받은 후 서버 로그를 확인해보니   
서버에는 관련 로그 내역이 없었다.

nginx에서는 buffer size보다 response size가 더 큰 경우 해당 응답을 버퍼링하지 않고 바로 전송하는데     
이때 클라이언트에서 부분적인 응답만 수신하고 연결이 끊길 수있다.    
그래서 `proxy_buffer_size` 값을 키우는 것도 방법이 되며 이 설정값은 하나의 버퍼 크기를 지정하는 값이므로 `proxy_buffers` 지시문을 통해 최대 버퍼 개수를 지정해두면 크기가 큰 응답을 하나의 버퍼에 다 담지 못하는 경우 `proxy_buffers`에 지정된 버퍼 개수만큼 사용해서 응답을 버퍼링한다.    

